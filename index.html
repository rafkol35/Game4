<html>
    <head>
        <meta charset="UTF-8">
        <title>game4</title>
        <!--<script src="https://code.createjs.com/createjs-2015.11.26.min.js"></script>-->
        <script src="https://code.createjs.com/createjs-2015.11.26.min.js"></script>
        <script type="text/javascript" src="jquery-1.10.2.min.js"></script>
        <script src="jquery-mousewheel-3.1.13/jquery.mousewheel.min.js"></script>  
        <script type="text/javascript" src="jquery-ui.min.js"></script>

        <script type="text/javascript" src="settings.js"></script>
        <script type="text/javascript" src="utils.js"></script>

        <script type="text/javascript" src="letter.js"></script>

        <link rel="Stylesheet" type="text/css" href="style.css" />

        <script>
            var panelGame;
            var panelSettings;
            var panelCurrentText;
            var panelCurrent;

            var preload;
            var canvas, stage;
            //var drawingCanvas;
            var letters = new Array();

            function onOff(wonoff) {
                console.log(wonoff.attr('id'));

                panelGame.hide();
                panelSettings.hide();
                panelCurrentText.hide();

                panelCurrent = wonoff;
                panelCurrent.show();
            }

            function refreshAll(){
                //console.log("refreshAll");
                canvas.width = settings.sts["PageSizeX"] * settings.sts["LetterWidth"];
                canvas.height = settings.sts["PageSizeY"] * (settings.sts["LetterHeight"] + settings.sts["LineSpace"]);
                
                for(var i = 0 ; i < letters.length ; ++i )
                {
                    var letter = letters[i];
                    letter.update();
                    letter.shape.x = letter.x * settings.sts["LetterWidth"];
                    letter.shape.y = letter.y * (settings.sts["LetterHeight"] + settings.sts["LineSpace"]);
                }
            }
            
            function init() {
                panelGame = $('#divGame');
                panelSettings = $('#divSettings');
                panelCurrentText = $('#divCurrentText');

                $('#menuItemGame').mousedown(function () {
                    onOff(panelGame);
                });
                $('#menuItemSettings').mousedown(function () {
                    onOff(panelSettings);
                });
                $('#menuItemCurrentText').mousedown(function () {
                    onOff(panelCurrentText);
                });

                onOff(panelSettings);

                initSettings();

                if (!createjs.Sound.initializeDefaultPlugins()) {
                    document.getElementById("error").style.display = "block";
                    document.getElementById("content").style.display = "none";
                    return;
                }
                canvas = document.getElementById("gameCanvas");
                stage = new createjs.Stage(canvas);
                //stage.autoClear = false;
                stage.enableDOMEvents(true);

                createjs.Ticker.timingMode = createjs.Ticker.RAF;
                createjs.Ticker.addEventListener("tick", updateScene);

                var colors = ["#828b20", "#b0ac31", "#cbc53d", "#fad779", "#f9e4ad", "#faf2db", "#563512", "#9b4a0b", "#d36600", "#fe8a00", "#f9a71f"];
                var radius = 50;
                var rings = 10000;

                //letter = createjs.

                //canvas.width = 800;

//		for (var j = 0; j < rings; ++j) {
//                    letter = new createjs.Shape();
//                    letter.graphics.beginFill(colors[Math.random() * colors.length | 0]).drawRect(0, 0, 50, 50);
//                    letter.x = Math.random() * canvas.width;
//                    letter.y = Math.random() * canvas.height;
//                    letter.snapToPixel = true;
//                    
//                    stage.addChild(letter);
//                    //letter.cache(0,0,50,50);
//                    //letter.uncache();
//                }

                for( var x = 0 ; x < 10 ; ++x )
                {
                    for( var y = 0 ; y < 10 ; ++y )
                    {
                        var letter = new Letter(x,y);
                        stage.addChild(letter.shape);
                        letters.push(letter);
                    }
                }

                fpsLabel = new createjs.Text("-- fps", "bold 18px Arial", "#000");
                stage.addChild(fpsLabel);
                fpsLabel.x = 0;
                fpsLabel.y = 0;

                stage.update();


                //const square = new Letter2(10, 10);
                fpsLabel.text = "aaa : " + settings.letterWidth;
                
                refreshAll();                
            }

            var fpsLabel;
            var fps = 0;
            var lt;

            function updateScene(event) {
                //fpsLabel.text = Math.round(createjs.Ticker.getMeasuredFPS()) + " fps";
                //fpsLabel.text = "aaa : " + letter.getSth(5);

                var ct = createjs.Ticker.getTime();
                var dt = ct - lt;
                lt = ct;

                if (isNaN(dt))
                    return;
                stage.update();
            }

        </script>

    </head>
    <body onload="init();" style="background-color: black; text-align: center">
        <div id="all">

            <div id="menu">
                <div id="menuItemGame" class="menuItem">Gra</div>
                <div id="menuItemSettings" class="menuItem">Ustawienia</div>
                <div id="menuItemCurrentText" class="menuItem">Aktualny tekst</div>
            </div>

            <div id="divGame">
                <canvas id="gameCanvas" style="background-color: brown;" width="500" height="600"></canvas>
            </div>            
            <div id="divSettings">Settings<br />
                <table>
                    <tr>
                        <td>Ilość znaków w linii: </td><td><input id="spinnerPageSizeX" name="value" value="100" class="settingsSpinner"></td>
                    </tr>
                    <tr>
                        <td>Liczba lini: </td><td><input id="spinnerPageSizeY" name="value" value="50" class="settingsSpinner"></td>
                    </tr>
                    <tr>
                        <td>Odstęp miedzy liniami: </td><td><input id="spinnerLineSpace" name="value" value="50" class="settingsSpinner"></td>
                    </tr>
                    <tr>
                        <td>Odstęp miedzy literami: </td><td><input id="spinnerLetterSpace" name="value" value="50" class="settingsSpinner"></td>
                    </tr>
                    <tr>
                        <td>Szerokość litery:</td><td> <input id="spinnerLetterWidth" name="value" value="50" class="settingsSpinner"></td>
                    </tr>
                    <tr>
                        <td>Wysokość litery: </td><td> <input id="spinnerLetterHeight" name="value" value="50" class="settingsSpinner"></td>
                    </tr>

                </table>
            </div>
            <div id="divCurrentText">CurrentText</div>

        </div>
    </body>
</html>