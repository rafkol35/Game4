<html>
    <head>
        <meta charset="UTF-8">
        <title>game4</title>
        <!--<script src="https://code.createjs.com/createjs-2015.11.26.min.js"></script>-->
        <script src="https://code.createjs.com/createjs-2015.11.26.min.js"></script>
        <script type="text/javascript" src="jquery-1.10.2.min.js"></script>
        <script src="jquery-mousewheel-3.1.13/jquery.mousewheel.min.js"></script>  
        <script type="text/javascript" src="jquery-ui.min.js"></script>

        <script type="text/javascript" src="settings.js"></script>
        
        <link rel="stylesheet" media="screen" type="text/css" href="colorpicker/css/colorpicker.css" />
        <script type="text/javascript" src="colorpicker/js/colorpicker.js"></script>
        <script type="text/javascript" src="colorpicker/js/eye.js"></script>
        <script type="text/javascript" src="colorpicker/js/utils.js"></script>
        <script type="text/javascript" src="colorpicker/js/layout.js?ver=1.0.2"></script>

    
        <script type="text/javascript" src="utils.js"></script>

        <script type="text/javascript" src="letter.js"></script>

        <link rel="Stylesheet" type="text/css" href="style.css" />

        <script>
            var panelGame;
            var panelSettings;
            var panelCurrentText;
            var panelCurrent;

            var preload;
            var canvas, stage;
            //var drawingCanvas;
            var letters = new Array();
            var cursorPosX = 0;
            var cursorPosY = 0;
                    
            function onOff(wonoff) {
                //console.log(wonoff.attr('id'));

                panelGame.hide();
                panelSettings.hide();
                panelCurrentText.hide();

                panelCurrent = wonoff;
                panelCurrent.show();
            }

            function refreshAll(){
                //console.log("refreshAll");
                canvas.width = settings.sts["PageSizeX"] * settings.sts["LetterWidth"];
                canvas.height = settings.sts["PageSizeY"] * (settings.sts["LetterHeight"] + settings.sts["LineSpace"]);
                
                for(var i = 0 ; i < letters.length ; ++i )
                {
                    var letter = letters[i];
                    letter.update();
                    letter.shape.x = letter.x * settings.sts["LetterWidth"];
                    letter.shape.y = letter.y * (settings.sts["LetterHeight"] + settings.sts["LineSpace"]);
                    //letter.shate.cache(0,0,settings.sts["LetterWidth"],settings.sts["LetterHeight"])
                }
            }
            
            function init() {
                panelGame = $('#divGame');
                panelSettings = $('#divSettings');
                panelCurrentText = $('#divCurrentText');

                $('#menuItemGame').mousedown(function () {
                    onOff(panelGame);
                });
                $('#menuItemSettings').mousedown(function () {
                    onOff(panelSettings);
                });
                $('#menuItemCurrentText').mousedown(function () {
                    onOff(panelCurrentText);
                });

                onOff(panelSettings);

                initSettings();

                if (!createjs.Sound.initializeDefaultPlugins()) {
                    document.getElementById("error").style.display = "block";
                    document.getElementById("content").style.display = "none";
                    return;
                }
                canvas = document.getElementById("gameCanvas");
                stage = new createjs.Stage(canvas);
                //stage.autoClear = false;
                stage.enableDOMEvents(true);

                //$("#gameCanvas").css("background-color", "yellow");

                createjs.Ticker.timingMode = createjs.Ticker.RAF;
                createjs.Ticker.addEventListener("tick", updateScene);

                var colors = ["#828b20", "#b0ac31", "#cbc53d", "#fad779", "#f9e4ad", "#faf2db", "#563512", "#9b4a0b", "#d36600", "#fe8a00", "#f9a71f"];
                var radius = 50;
                var rings = 10000;

                //letter = createjs.

                //canvas.width = 800;

//		for (var j = 0; j < rings; ++j) {
//                    letter = new createjs.Shape();
//                    letter.graphics.beginFill(colors[Math.random() * colors.length | 0]).drawRect(0, 0, 50, 50);
//                    letter.x = Math.random() * canvas.width;
//                    letter.y = Math.random() * canvas.height;
//                    letter.snapToPixel = true;
//                    
//                    stage.addChild(letter);
//                    //letter.cache(0,0,50,50);
//                    //letter.uncache();
//                }

//                for( var x = 0 ; x < 10 ; ++x )
//                {
//                    for( var y = 0 ; y < 10 ; ++y )
//                    {
//                        var letter = new Letter(x,y);
//                        stage.addChild(letter.shape);
//                        letters.push(letter);
//                    }
//                }

//                fpsLabel = new createjs.Text("-- fps", "bold 18px Arial", "#000");
//                stage.addChild(fpsLabel);
//                fpsLabel.x = 0;
//                fpsLabel.y = 0;

                stage.update();

                document.onkeydown = handleKeyDown;
                //document.onkeyup = handleKeyUp;
            
                //const square = new Letter2(10, 10);
                //fpsLabel.text = "aaa : " + settings.letterWidth;
                
                refreshAll();                
            }

            //var fpsLabel;
            var fps = 0;
            var lt;

            function updateScene(event) {
                //fpsLabel.text = Math.round(createjs.Ticker.getMeasuredFPS()) + " fps";
                //fpsLabel.text = "aaa : " + letter.getSth(5);

                var ct = createjs.Ticker.getTime();
                var dt = ct - lt;
                lt = ct;

                if (isNaN(dt))
                    return;
                stage.update();
            }

            function handleKeyDown(e) {
                //cross browser issues exist
                if (!e) {
                    var e = window.event;
                }
                  
                if(panelCurrent !== panelGame) return;
                    
                //console.log(settings.colors.indexOf(e.keyCode));
                //console.log(settings.colors[e.keyCode]);
                //console.log(e.keyCode);
                
                //if( settings.colors.indexOf(e.keyCode) !== -1 ){
                
                //console.log(cursorPosX + " " + cursorPosY);
                
                if( cursorPosY === settings.sts["PageSizeY"]-1 ){ // jezeli kursor w ostatniej lini
                    // enter nie moze byc wcale
                    if( e.keyCode === 13 ) //enter
                    {
                        e.preventDefault();
                        return false;
                    }
                    if( cursorPosX === settings.sts["PageSizeX"] ){
                        if( e.keyCode !== 8 ) // backspace dozwolony
                        {
                            e.preventDefault();
                            return false;
                        }
                    }
                }
                    
                if( settings.colors[e.keyCode] !== undefined ){
                    var letter = new Letter(cursorPosX,cursorPosY,e.keyCode);
                    stage.addChild(letter.shape);
                    letters.push(letter);
                    if( cursorPosX === settings.sts["PageSizeX"]-1 && cursorPosY !== settings.sts["PageSizeY"]-1){
                        cursorPosX = 0;
                        cursorPosY++;
                    }
                    else
                    {
                        cursorPosX++;
                    }
                    refreshAll();
                }
                
                if( e.keyCode === 8 ){
                    if( letters.length > 0 ){
                        var lastLetter = letters[letters.length-1];
                        cursorPosX = lastLetter.x;
                        cursorPosY = lastLetter.y;
                        
                        stage.removeChild(lastLetter.shape);
                        letters.pop();                        
                        //cursorPosX--;
                        
                        refreshAll();
                    }
                }
                
                if( e.keyCode === 32 || e.keyCode === 8){
                    e.preventDefault();
                    return false;
                }
                
                if( e.keyCode === 13 ) //enter
                {
                    if( cursorPosX !== 0 ) cursorPosY++;
                    cursorPosX = 0;
                }
                
                //console.log(e.keyCode);
                
//                switch (e.keyCode) {
//                }
            }
            function randColors(){
                settings.randomizeColors();
                fillClrSmps();
                refreshAll();
            }
            function fillColorsWithGradient(){
                settings.fillColorsWithGradient();
                fillClrSmps();
                refreshAll();
            }
            
        </script>

    </head>
    <body onload="init();" style="background-color: black; text-align: center">
        <div id="all">

            <div id="menu">
                <div id="menuItemGame" class="menuItem">Gra</div>
                <div id="menuItemSettings" class="menuItem">Ustawienia</div>
                <div id="menuItemCurrentText" class="menuItem">Tekst</div>
            </div>

            <div id="divGame">
                <canvas id="gameCanvas" style="background-color: white;" width="500" height="600"></canvas>
            </div>            
            <div id="divSettings">Ustawienia<br />
                <table id="tableNumbers">
                    <tr>
                        <td>Ilość znaków w linii: </td><td><input id="spinnerPageSizeX" disabled="disabled" name="value" value="100" class="settingsSpinner"></td>
                    </tr>
                    <tr>
                        <td>Liczba lini: </td><td><input id="spinnerPageSizeY" disabled="disabled" name="value" value="50" class="settingsSpinner"></td>
                    </tr>
                    <tr>
                        <td>Odstęp miedzy liniami: </td><td><input id="spinnerLineSpace" disabled="disabled" name="value" value="50" class="settingsSpinner"></td>
                    </tr>
                    <tr>
                        <td>Odstęp miedzy literami: </td><td><input id="spinnerLetterSpace" disabled="disabled" name="value" value="50" class="settingsSpinner"></td>
                    </tr>
                    <tr>
                        <td>Szerokość litery:</td><td> <input id="spinnerLetterWidth" disabled="disabled" name="value" value="50" class="settingsSpinner"></td>
                    </tr>
                    <tr>
                        <td>Wysokość litery: </td><td> <input id="spinnerLetterHeight" disabled="disabled" name="value" value="50" class="settingsSpinner"></td>
                    </tr>

                </table>

                <div id="settingsColors">
                    <input type="button" onclick="randColors()" value="Losuj nowe" />
                    <div>
                        <table id="tableGradient">
                            <tr><td>Gradient</td><td></td></tr>
                            <tr><td>Od</td><td><div id="clrsmpGradientFrom" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpickerGradientFrom" value="ffffff" /></td></tr>
                            <tr><td>Do</td><td><div id="clrsmpGradientTo" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpickerGradientTo" value="ffffff" /></td></tr>
                            <tr><td><input type="button" onclick="fillColorsWithGradient()" value="Generuj" /></td><td></td></tr>
                        </table>
                    </div>
                <table id="tableColors">
                    <tr><td>Płótno</td><td><div id="clrsmpCanvas" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpickerCanvas" value="ffffff" /></td></tr>
                    <tr><td>Spacja</td><td><div id="clrsmpSpace" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpickerSpace" value="ffffff" /></td></tr>
                    
                    <tr><td>A</td><td><div id="clrsmp65" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpicker65" value="ffffff" /></td></tr>
                    <tr><td>B</td><td><div id="clrsmp66" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpicker66" value="ffffff" /></td></tr>
                    <tr><td>C</td><td><div id="clrsmp67" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpicker67" value="ffffff" /></td></tr>
                    <tr><td>D</td><td><div id="clrsmp68" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpicker68" value="ffffff" /></td></tr>                    
                    
                    <tr><td>E</td><td><div id="clrsmp69" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpicker69" value="ffffff" /></td></tr>
                    <tr><td>F</td><td><div id="clrsmp70" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpicker70" value="ffffff" /></td></tr>
                    <tr><td>G</td><td><div id="clrsmp71" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpicker71" value="ffffff" /></td></tr>
                    <tr><td>H</td><td><div id="clrsmp72" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpicker72" value="ffffff" /></td></tr>
                    
                    <tr><td>I</td><td><div id="clrsmp73" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpicker73" value="ffffff" /></td></tr>
                    <tr><td>J</td><td><div id="clrsmp74" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpicker74" value="ffffff" /></td></tr>
                    <tr><td>K</td><td><div id="clrsmp75" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpicker75" value="ffffff" /></td></tr>
                    <tr><td>L</td><td><div id="clrsmp76" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpicker76" value="ffffff" /></td></tr>
                    
                    <tr><td>M</td><td><div id="clrsmp77" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpicker77" value="ffffff" /></td></tr>
                    <tr><td>N</td><td><div id="clrsmp78" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpicker78" value="ffffff" /></td></tr>
                    <tr><td>O</td><td><div id="clrsmp79" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpicker79" value="ffffff" /></td></tr>
                    <tr><td>P</td><td><div id="clrsmp80" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpicker80" value="ffffff" /></td></tr>
                    
                    <tr><td>Q</td><td><div id="clrsmp81" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpicker81" value="ffffff" /></td></tr>
                    <tr><td>R</td><td><div id="clrsmp82" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpicker82" value="ffffff" /></td></tr>
                    <tr><td>S</td><td><div id="clrsmp83" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpicker83" value="ffffff" /></td></tr>
                    <tr><td>T</td><td><div id="clrsmp84" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpicker84" value="ffffff" /></td></tr>
                    
                    <tr><td>U</td><td><div id="clrsmp85" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpicker85" value="ffffff" /></td></tr>
                    <tr><td>V</td><td><div id="clrsmp86" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpicker86" value="ffffff" /></td></tr>
                    <tr><td>W</td><td><div id="clrsmp87" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpicker87" value="ffffff" /></td></tr>
                    <tr><td>X</td><td><div id="clrsmp88" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpicker88" value="ffffff" /></td></tr>
                    
                    <tr><td>Y</td><td><div id="clrsmp89" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpicker89" value="ffffff" /></td></tr>
                    <tr><td>Z</td><td><div id="clrsmp90" class="clrsmp"></div></td><td><input type="text" maxlength="6" size="6" id="colorpicker90" value="ffffff" /></td></tr>
                    
                </table>
                </div>
            </div>
            <div id="divCurrentText">Tekst</div>

        </div>
    </body>
</html>